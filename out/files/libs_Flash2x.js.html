<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libs/Flash2x.js - Flash2LayaAir API文档</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Flash2LayaAir API文档" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.6</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/annie.Media.html">annie.Media</a></li>
                                <li><a href="../classes/annie.MovieClip.html">annie.MovieClip</a></li>
                                <li><a href="../classes/annie.Shape.html">annie.Shape</a></li>
                                <li><a href="../classes/annie.Sound.html">annie.Sound</a></li>
                                <li><a href="../classes/annie.URLLoader.html">annie.URLLoader</a></li>
                                <li><a href="../classes/annie.Video.html">annie.Video</a></li>
                                <li><a href="../classes/Flash2x.html">Flash2x</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/annie.html">annie</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: libs/Flash2x.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Flash资源加载或者管理类，静态类，不可实例化
 * 一般都是初始化或者设置从Flash里导出的资源
 * @class Flash2x
 */
var Flash2x;
(function (Flash2x) {
    var URLLoader = annie.URLLoader;
    var Event = laya.events.Event;
    var Texture = laya.resource.Texture;
    var Sprite = laya.display.Sprite;
    // import ColorMatrixFilter=laya.filters.ColorFilter;
    var _isReleased = false;
    /**
     * 存储加载资源的总对象
     * @type {Object}
     */
    var res = {};
    /**
     * 加载器是否正在加载中
     */
    var _isLoading;
    /**
     * 加载中的场景名列表
     */
    var _loadSceneNames;
    /**
     * 加载地址的域名地址或前缀
     */
    var _domain;
    /**
     * 当前加载到哪一个资源
     */
    var _loadIndex;
    /**
     * 当前加载的总资源数
     */
    var _totalLoadRes;
    /**
     * 当前已经加载的资源数
     */
    var _loadedLoadRes;
    /**
     * 加载资源的完成回调
     */
    var _completeCallback;
    /**
     * 加载资源时的进度回调
     */
    var _progressCallback;
    /**
     * 加载配置文件的加载器
     */
    var _JSONQueue;
    /**
     * 加载资源文件的加载器
     */
    var _loaderQueue;
    /**
     * 加载器是否初始化过
     */
    var _isInited;
    /**
     * 当前加载的资源配置文件内容
     */
    var _currentConfig;
    /**
     * 获取当前加载的时间当作随机数用
     */
    var _time;
    /**
     * 加载资源数和总资源数的比
     */
    var _loadPer;
    /**
     * 单个资源占总资源数的比
     */
    var _loadSinglePer;
    /**
     * 加载一个flash2x转换的文件内容,如果未加载完成继续调用此方法将会刷新加载器,中断未被加载完成的资源!
     * @method loadScene
     * @public
     * @static
     * @since 1.0.0
     * @param {string} sceneName fla通过flash2x转换时设置的包名
     * @param {Function} progressFun 加载进度回调,回调参数为当前的进度值1-100.
     * @param {Function} completeFun 加载完成回高,无回调参数
     * @param {string} domain 加载时要设置的url前缀,默认则不更改加载路径。
     */
    Flash2x.loadScene = function (sceneName, progressFun, completeFun, domain) {
        if (domain === void 0) { domain = &quot;&quot;; }
        //加载资源配置文件
        if (_isLoading) {
            _JSONQueue.loadCancel();
            _loaderQueue.loadCancel();
        }
        _loadSceneNames = [];
        if (domain == undefined) {
            domain = &quot;&quot;;
        }
        _domain = domain;
        if (typeof (sceneName) == &quot;string&quot;) {
            if (!isLoadedScene(sceneName)) {
                _loadSceneNames.push(sceneName);
                res[sceneName] = new Object();
            }
        }
        else {
            var len = sceneName.length;
            for (var i = 0; i &lt; len; i++) {
                if (!isLoadedScene(sceneName[i])) {
                    res[sceneName[i]] = new Object();
                    _loadSceneNames.push(sceneName[i]);
                }
            }
        }
        if (_loadSceneNames.length == 0) {
            if (completeFun) {
                completeFun();
            }
            return;
        }
        if (!_isInited) {
            _time = new Date().getTime();
            _JSONQueue = new URLLoader();
            _JSONQueue.on(Event.COMPLETE, null, onCFGComplete);
            _loaderQueue = new URLLoader();
            _loaderQueue.on(Event.COMPLETE, null, _onRESComplete);
            _loaderQueue.on(Event.PROGRESS, null, _onRESProgress);
            _isInited = true;
        }
        _loadPer = 0;
        _loadIndex = 0;
        _totalLoadRes = 0;
        _loadedLoadRes = 0;
        _isLoading = true;
        _completeCallback = completeFun;
        _progressCallback = progressFun;
        _currentConfig = [];
        if (!_isReleased) {
            _loadConfig();
        }
        else {
            //加载正式的单个文件
            _loadIndex = 0;
            _totalLoadRes = _loadSceneNames.length;
            _loadSinglePer = 1 / _totalLoadRes;
            for (var i = 0; i &lt; _totalLoadRes; i++) {
                _currentConfig.push([{ src: &quot;src/&quot; + _loadSceneNames[i] + &quot;.swf&quot; }]);
            }
            _loadRes();
        }
    };
    function _loadConfig() {
        _JSONQueue.load(_domain + &quot;resource/&quot; + _loadSceneNames[_loadIndex] + &quot;/&quot; + _loadSceneNames[_loadIndex] + &quot;.res.json?t=&quot; + _time);
    }
    function onCFGComplete(e) {
        //配置文件加载完成
        var resList = e.data.response;
        _currentConfig.push(resList);
        _totalLoadRes += resList.length;
        _loadIndex++;
        if (_loadSceneNames[_loadIndex]) {
            _loadConfig();
        }
        else {
            //所有配置文件加载完成,那就开始加载资源
            _loadIndex = 0;
            _loadSinglePer = 1 / _totalLoadRes;
            _loadRes();
        }
    }
    function _onRESProgress(e) {
        if (_progressCallback) {
            _progressCallback((_loadPer + e.loadedBytes / e.totalBytes * _loadSinglePer) * 100 &gt;&gt; 0);
        }
    }
    function _onRESComplete(e) {
        var scene = _loadSceneNames[_loadIndex];
        if (!_isReleased) {
            if (e.data.type != &quot;js&quot; &amp;&amp; e.data.type != &quot;css&quot;) {
                var id = _currentConfig[_loadIndex][0].id;
                res[scene][id] = e.data.response;
            }
        }
        else {
            var F2x = Flash2x;
            var JSResItem = F2x[scene + &quot;Res&quot;];
            for (var item in JSResItem) {
                var resItem;
                if (JSResItem[item].indexOf(&quot;audio/&quot;) &gt; 0) {
                    resItem = new Audio();
                    resItem.src = JSResItem[item];
                }
                else if (JSResItem[item].indexOf(&quot;image/&quot;) &gt; 0) {
                    resItem = new Image();
                    resItem.src = JSResItem[item];
                }
                else {
                    resItem = JSON.parse(JSResItem[item]);
                }
                res[scene][item] = resItem;
            }
            delete F2x[scene + &quot;Res&quot;];
        }
        _checkComplete();
    }
    function _checkComplete() {
        _loadedLoadRes++;
        _loadPer = _loadedLoadRes / _totalLoadRes;
        _currentConfig[_loadIndex].shift();
        if (_currentConfig[_loadIndex].length &gt; 0) {
            _loadRes();
        }
        else {
            var info = {};
            info.sceneName = _loadSceneNames[_loadIndex];
            _loadIndex++;
            info.sceneId = _loadIndex;
            info.sceneTotal = _loadSceneNames.length;
            if (_loadIndex == _loadSceneNames.length) {
                //全部资源加载完成
                _isLoading = false;
                //_progressCallback(100);
                _completeCallback(info);
            }
            else {
                _completeCallback(info);
                _loadRes();
            }
        }
    }
    function _loadRes() {
        var url = _domain + _currentConfig[_loadIndex][0].src;
        if (_isReleased) {
            _loaderQueue.responseType = &quot;js&quot;;
            url += &quot;?v=&quot; + _isReleased;
        }
        _loaderQueue.load(url);
    }
    /**
     * 判断一个场景是否已经被加载
     * @method isLoadedScene
     * @public
     * @static
     * @since 1.0.0
     * @param {string} sceneName
     * @returns {boolean}
     */
    function isLoadedScene(sceneName) {
        if (res[sceneName] != undefined &amp;&amp; res[sceneName] != null) {
            return true;
        }
        else {
            return false;
        }
    }
    Flash2x.isLoadedScene = isLoadedScene;
    /**
     * 删除一个场景资源,以方便系统垃圾回收
     * @method unLoadScene
     * @public
     * @static
     * @since 1.0.2
     * @param {string} sceneName
     * @param {WebGLRenderingContext} gl 如果是webgl渲染模式，请设置渲染的webgl对象，以方便删除不再需要使用的texture对象
     */
    function unLoadScene(sceneName, gl) {
        if (gl === void 0) { gl = null; }
        //删除webgl贴图资源
        if (gl) {
            for (var item in res[sceneName]) {
                if (res[sceneName][item].nodeName &amp;&amp; res[sceneName][item].nodeName == &quot;IMG&quot; &amp;&amp; res[sceneName][item].texture) {
                    gl.deleteTexture(res[sceneName][item].texture);
                }
            }
        }
        delete res[sceneName];
        var scene = eval(sceneName);
        for (var i in scene) {
            delete scene[i];
        }
        eval(sceneName + &quot;=null;&quot;);
    }
    Flash2x.unLoadScene = unLoadScene;
    /**
     * 获取已经加载场景中的声音或视频资源
     * @method getMediaByName
     * @public
     * @static
     * @since 1.0.0
     * @param {string} sceneName
     * @param {string} mediaName
     * @returns {any}
     */
    function getMediaByName(sceneName, mediaName) {
        var s = res;
        if (s[sceneName][mediaName]) {
            return s[sceneName][mediaName];
        }
        return null;
    }
    Flash2x.getMediaByName = getMediaByName;
    /**
     * 通过已经加载场景中的图片资源创建Bitmap对象实例,此方法一般给Flash2x工具自动调用
     * @method b
     * @public
     * @since 1.0.0
     * @static
     * @param {string} sceneName
     * @param {string} imageName
     * @returns {any}
     */
    function b(sceneName, imageName, isTexture) {
        if (isTexture === void 0) { isTexture = false; }
        var s = res;
        var isFind = false;
        var sp = new Sprite();
        if (s[sceneName][imageName]) {
            if (isTexture)
                return s[sceneName][imageName];
            sp.graphics.drawTexture(s[sceneName][imageName]);
            return sp;
        }
        else {
            var m_1 = 0;
            while (s[sceneName][&quot;F2xSSIMG&quot; + m_1]) {
                var data = s[sceneName][&quot;F2xSSIMGData&quot; + m_1];
                if (data[imageName] != undefined) {
                    isFind = true;
                    var imgData = data[imageName];
                    var spriteSheet = s[sceneName][&quot;F2xSSIMG&quot; + m_1];
                    var t_1 = Texture.createFromTexture(spriteSheet, imgData.x, imgData.y, imgData.width, imgData.height);
                    if (isTexture)
                        return t_1;
                    sp.graphics.drawTexture(Texture.createFromTexture(spriteSheet, imgData.x, imgData.y, imgData.width, imgData.height));
                    return sp;
                }
                m_1++;
            }
            console.log(&quot;未找到资源文件&quot;);
            return null;
        }
    }
    Flash2x.b = b;
    /**
     * 用一个对象批量设置另一个对象的属性值,此方法一般给Flash2x工具自动调用
     * @method d
     * @public
     * @static
     * @since 1.0.0
     * @param {Object} display
     * @param {Object} baseInfo
     * @param {Object} extendInfo
     */
    function d(display, baseInfo, extendInfo) {
        if (baseInfo === void 0) { baseInfo = null; }
        if (extendInfo === void 0) { extendInfo = null; }
        if (baseInfo) {
            if (baseInfo.x != undefined) {
                display.x = baseInfo.x;
            }
            if (baseInfo.y != undefined) {
                display.y = baseInfo.y;
            }
            if (baseInfo.a != undefined) {
                display.scaleX = baseInfo.a;
            }
            if (baseInfo.b != undefined) {
                display.scaleY = baseInfo.b;
            }
            if (baseInfo.r != undefined) {
                display.rotation = baseInfo.r;
            }
            if (baseInfo.c != undefined) {
                display.skewX = baseInfo.c;
            }
            if (baseInfo.d != undefined) {
                display.skewY = baseInfo.d;
            }
            if (baseInfo.o != undefined) {
                display.alpha = baseInfo.o;
            }
            if (baseInfo.v != undefined) {
                display.visible = baseInfo.v;
            }
        }
        if (extendInfo &amp;&amp; extendInfo.length &gt; 0) {
            console.log(&quot;Flash2LayaAir还不能很好的支持滤镜功能,如果需要推荐使用Flash2AnnieJS,http://annie2x.com&quot;);
        }
    }
    Flash2x.d = d;
    /**
     * 创建一个动态文本或输入文本,此方法一般给Flash2x工具自动调用
     * @method t
     * @public
     * @static
     * @since 1.0.0
     * @param {number} type
     * @param {string} text
     * @param {number} size
     * @param {string} color
     * @param {string} face
     * @param {number} top
     * @param {number} left
     * @param {number} width
     * @param {number} height
     * @param {number} lineSpacing
     * @param {string} align
     * @param {boolean} italic
     * @param {boolean} bold
     * @param {string} lineType
     * @param {boolean} showBorder
     * @returns {annie.TextFiled|annie.InputText}
     */
    function t(type, text, size, color, face, top, left, width, height, lineSpacing, align, italic, bold, lineType, showBorder) {
        if (italic === void 0) { italic = false; }
        if (bold === void 0) { bold = false; }
        if (lineType === void 0) { lineType = &quot;single&quot;; }
        if (showBorder === void 0) { showBorder = false; }
        var textObj;
        if (type == 0 || type == 1) {
            textObj = new laya.display.Text();
            textObj.width = width;
            textObj.text = text;
        }
        else {
            textObj = new laya.display.Input();
            textObj.size(width, height);
            textObj.nativeInput.placeholder = text;
        }
        textObj.overflow = Laya.Text.HIDDEN;
        textObj.font = face;
        textObj.fontSize = size;
        textObj.leading = lineSpacing - size;
        textObj.align = align;
        textObj.italic = italic;
        textObj.bold = bold;
        textObj.color = color;
        textObj.padding = [top, left, top, left];
        if (lineType != &quot;single&quot;) {
            textObj.wordWrap = true;
            if (type &gt; 1) {
                textObj.multiline = true;
            }
        }
        if (showBorder) {
            textObj.borderColor = &quot;#000000&quot;;
        }
        return textObj;
    }
    Flash2x.t = t;
    /**
     * 获取矢量位图填充所需要的位图,为什么写这个方法,是因为作为矢量填充的位图不能存在于SpriteSheet中,要单独画出来才能正确的填充到矢量中
     */
    function sb(sceneName, bitmapName) {
        var sbName = &quot;_f2x_s&quot; + bitmapName;
        if (res[sceneName][sbName]) {
            return res[sceneName][sbName];
        }
        else {
            var bitmapData = null;
            var bitmap = b(sceneName, bitmapName, true);
            if (bitmap) {
                bitmapData = annie.Shape.convertToImage(bitmap);
                res[sceneName][sbName] = bitmapData;
                return bitmapData;
            }
            else {
                console.log(&quot;error:矢量位图填充时,未找到位图资源!&quot;);
                return null;
            }
        }
    }
    /**
     * 创建一个Shape矢量对象,此方法一般给Flash2x工具自动调用
     * @method s
     * @public
     * @static
     * @since 1.0.0
     * @param {Object} pathObj
     * @param {Object} fillObj
     * @param {Object} strokeObj
     * @returns {annie.Shape}
     */
    function s(pathObj, fillObj, strokeObj) {
        var shape = new annie.Shape();
        if (fillObj) {
            if (fillObj.type == 0) {
                shape.beginFill(fillObj.color);
            }
            else if (fillObj.type == 1) {
                shape.beginRadialGradientFill(fillObj.gradient[0], fillObj.gradient[1], fillObj.points);
            }
            else if (fillObj.type == 2) {
                shape.beginLinearGradientFill(fillObj.gradient[0], fillObj.gradient[1], fillObj.points);
            }
            else {
                shape.beginBitmapFill(sb(fillObj.bitmapScene, fillObj.bitmapName), fillObj.matrix);
            }
        }
        if (strokeObj) {
            if (strokeObj.type == 0) {
                shape.beginStroke(strokeObj.color, strokeObj.lineWidth);
            }
            else if (strokeObj.type == 1) {
                shape.beginRadialGradientStroke(strokeObj.gradient[0], strokeObj.gradient[1], strokeObj.points, strokeObj.lineWidth);
            }
            else if (strokeObj.type == 2) {
                shape.beginLinearGradientStroke(strokeObj.gradient[0], strokeObj.gradient[1], strokeObj.points, strokeObj.lineWidth);
            }
            else {
                shape.beginBitmapStroke(sb(strokeObj.bitmapScene, strokeObj.bitmapName), strokeObj.matrix, strokeObj.lineWidth);
            }
        }
        if (pathObj.type == 0) {
            shape.decodePath(pathObj.data);
        }
        else {
            shape.drawRoundRect(pathObj.data.x, pathObj.data.y, pathObj.data.w, pathObj.data.h, pathObj.data.topLeftRadius, pathObj.data.topRightRadius, pathObj.data.bottomLeftRadius, pathObj.data.bottomRightRadius);
        }
        if (fillObj) {
            shape.endFill();
        }
        if (strokeObj) {
            shape.endStroke();
        }
        var sp = new Sprite();
        sp._f2xShape = shape;
        sp.graphics.drawTexture(shape.updateTexture(), shape.rect.x, shape.rect.y, shape.rect.width, shape.rect.height);
        return sp;
    }
    Flash2x.s = s;
    /**
     * 向后台请求或者传输数据的快速简便方法,比直接用URLLoader要方便,小巧
     * @method ajax
     * @public
     * @since 1.0.0
     * @param info 向后台传送数据所需要设置的信息
     * @param {url} info.url 向后台请求的地址
     * @param {string} info.type 向后台请求的类型 get 和 post,默认为get
     * @param {Function} info.success 发送成功后的回调方法,后台数据将通过参数传回
     * @param {Function} info.error 发送出错后的回调方法,出错信息通过参数传回
     * @param {Object} info.data 向后台发送的信息对象,默认为null
     * @param {string} info.responseType 后台返回数据的类型,默认为&quot;json&quot;
     */
    function ajax(info) {
        var urlLoader = new URLLoader();
        urlLoader.method = info.type == undefined ? &quot;get&quot; : info.type;
        urlLoader.data = info.data == undefined ? null : info.data;
        urlLoader.responseType = info.responseType == undefined ? &quot;text&quot; : info.responseType;
        if (info.success != undefined) {
            urlLoader.on(Event.COMPLETE, null, info.success);
        }
        if (info.error != undefined) {
            urlLoader.on(Event.ERROR, null, info.error);
        }
        urlLoader.load(info.url);
    }
    Flash2x.ajax = ajax;
    var jsonpScript = null;
    /**
     * jsonp调用方法
     * @method jsonp
     * @param url
     * @param type 0或者1 如果是0，后台返回的是data型jsonp 如果是1，后台返回的是方法型jsonp
     * @param callbackName
     * @param callbackFun
     * @static
     * @since 1.0.4
     */
    function jsonp(url, type, callbackName, callbackFun) {
        var w = window;
        if (type == 1) {
            w[callbackName] = callbackFun;
        }
        if (!jsonpScript) {
            jsonpScript = document.createElement(&#x27;script&#x27;);
            jsonpScript.onload = function () {
                if (type == 0) {
                    callbackFun(w[callbackName]);
                }
                jsonpScript.src = &quot;&quot;;
                w[callbackName] = null;
                delete w[callbackName];
            };
            document.getElementsByTagName(&#x27;head&#x27;)[0].appendChild(jsonpScript);
        }
        var param;
        if (url.indexOf(&quot;?&quot;) &gt; 0) {
            param = &quot;&amp;&quot;;
        }
        else {
            param = &quot;?&quot;;
        }
        jsonpScript.src = url + param + &quot;a_n_n_i_e=&quot; + Math.random() + &quot;&amp;callback=&quot; + callbackName;
    }
    Flash2x.jsonp = jsonp;
    function m(masked, mask) {
        mask.x -= masked.x;
        mask.y -= masked.y;
        masked.mask = mask;
    }
    Flash2x.m = m;
})(Flash2x || (Flash2x = {}));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
